<ng-container *ngIf="bundle">
  <div class="relative h-full" *ngIf="!isSelected && !isDetailsView">
    <div class="absolute top-[12px] ltr:left-[-8px] rtl:-right-[8px]" *ngIf="!isCollapsed">
      <app-option-item-tag
        [tag]="bookingFlow.Recommended"
        [data]="{
          adults: lowestBundleItem?.adults,
          children: lowestBundleItem?.children,
          pets: lowestBundleItem?.pets
        }"
        [isBundle]="true"
      ></app-option-item-tag>
    </div>
    <div class="rounded-[16px] overflow-hidden shadow-option-item flex flex-col h-full">
      <app-option-swiper [imgUrls]="imageUrls" [customClass]="isCollapsed ? 'h-[70px]' : 'h-[220px]'"></app-option-swiper>
      <div class="bg-button-hover-background-color p-[16px] flex justify-between flex-col flex-1" [ngClass]="{ '!h-[80px]': isCollapsed }">
        <div>
          <div class="text-[17px] font-medium leading-[24px] text-primary-color mb-[4px] line-clamp-1">{{ bundle?.ratePlan?.[0]?.name }}</div>
          <app-option-units-info [item]="unitsInfoItem()" [showText]="false" [full]="false"></app-option-units-info>
          <div class="mt-3" *ngIf="!isCollapsed">
            <ng-container *ngFor="let extras of bundle?.ratePlan?.[0]?.includedHotelExtrasList">
              <div class="flex items-center mb-2">
                <img loading="lazy" src="assets/beta/gift_opened.svg" />
                <span class="font-light text-[14px] ml-2">{{ extras.name }}</span>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="flex items-end justify-between" *ngIf="!isCollapsed">
          <app-option-price
            [price]="
              lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmount
                | calculatePriceWithTax
                  : lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmount
                  : (priceView === ePriceView.PerNight ? 'averageDailyRate' : 'totalSellingRate')
                  : (includeTax$ | async)
            "
            [shouldShowStrikeThrough]="lowestBundleItem?.items?.[0]?.rfcRatePlan?.shouldShowStrikeThrough"
            [originalPrice]="
              lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmountBeforeAdjustment
                | calculateFullPriceWithTax
                  : lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmountBeforeAdjustment
                  : (includeTax$ | async)
            "
            [adjustmentPercentage]="lowestBundleItem?.items?.[0]?.rfcRatePlan?.adjustmentPercentage"
            [priceView]="priceView"
            [fullPrice]="
              lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmount
                | calculatePriceWithTax: lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmount : 'totalSellingRate' : (includeTax$ | async)
            "
          ></app-option-price>
          <button
            type="button"
            class="rounded-[12px] h-[36px] px-[35px] bg-button-normal-background-color text-button-normal-color text-[12px] font-medium leading-[140%]"
            (click)="selectRatePlan.emit(bundle)"
          >
            Explore
          </button>
        </div>
      </div>
    </div>
  </div>

  <!--  ================================= SELECTED STATE =================================-->
  <div class="hidden pb-4 z-[32] relative" [class.!block]="isSelected && !isDetailsView">
    <div class="border-button-normal-background-color bg-button-normal-background-color border-[12px] rounded-[16px]">
      <div class="min-h-[calc(145px-24px)] rounded-[12px] flex items-center justify-center gap-[12px] bg-configurator-category-hover-background-color py-2">
        <div>
          <div class="text-[17px] leading-[23.8px] text-primary-color font-medium text-center mb-[12px] line-clamp-1">
            {{ bundle?.ratePlan?.[0]?.name }}
          </div>
          <div class="flex w-full justify-center">
            <app-option-price
              [price]="
                lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmount
                  | calculatePriceWithTax
                    : lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmount
                    : (priceView === ePriceView.PerNight ? 'averageDailyRate' : 'totalSellingRate')
                    : (includeTax$ | async)
              "
              [shouldShowStrikeThrough]="lowestBundleItem?.items?.[0]?.rfcRatePlan?.shouldShowStrikeThrough"
              [originalPrice]="
                lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmountBeforeAdjustment
                  | calculateFullPriceWithTax
                    : lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmountBeforeAdjustment
                    : (includeTax$ | async)
              "
              [adjustmentPercentage]="lowestBundleItem?.items?.[0]?.rfcRatePlan?.adjustmentPercentage"
              [priceView]="priceView"
              [parentClass]="'!text-primary-color'"
              [fullPrice]="
                lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalGrossAmount
                  | calculatePriceWithTax: lowestBundleItem?.items?.[0]?.rfcRatePlan?.totalBaseAmount : 'totalSellingRate' : (includeTax$ | async)
              "
            />
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- END SELECTED STATE -->

  <ng-container *ngIf="isDetailsView">
    <div class="flex flex-row sm:flex-col">
      <div class="rounded-[16px] overflow-hidden sm:w-full w-[500px] h-[280px]">
        <app-option-swiper [imgUrls]="imageUrls" [customClass]="'!sm:w-full !w-[500px] !h-[280px]'"></app-option-swiper>
      </div>
      <div class="flex-1 px-2 mt-2">
        <div class="text-[17px] font-medium leading-[24px] text-primary-color mb-[4px] sm:line-clamp-none line-clamp-1">{{ bundle?.ratePlan?.[0]?.name }}</div>
        <app-option-units-info [item]="unitsInfoItem()" [showText]="false" [full]="false"></app-option-units-info>

        <div class="flex mt-4 gap-x-1 flex-row sm:flex-col">
          <div class="w-[50%] sm:w-full">
            <div class="text-[12px] h-[75px] line-clamp-4 sm:line-clamp-none font-light">{{ (ratePlanList$ | async | getRatePlanDescription: bundle?.ratePlan?.[0]?.code) || 'No description' }}</div>
            <div class="flex items-start mt-5 sm:mt-4">
              <img loading="lazy" src="assets/icons/cancellation-policy.svg" class="translate-y-[20%]" />
              <div class="flex-1 pl-2">
                <div class="text-[14px] font-medium">Cancellation policy</div>
                <div class="text-[12px] font-medium">{{ ratePlanList$ | async | getCxlPolicy: bundle?.ratePlan?.[0]?.code : 'name' | stripHtml }}</div>
                <div class="line-clamp-1 text-[12px] font-light">
                  {{ ratePlanList$ | async | getCxlPolicy: bundle?.ratePlan?.[0]?.code | stripHtml }}
                </div>
              </div>
            </div>
            <div class="flex items-start mt-2">
              <img loading="lazy" src="assets/icons/payment.svg" class="translate-y-[20%]" />
              <div class="flex-1 pl-2">
                <div class="text-[14px] font-medium">Payment term</div>
                <div class="text-[12px] font-medium">{{ ratePlanList$ | async | getPaymentTerm: bundle?.ratePlan?.[0]?.code : 'name' | stripHtml }}</div>
                <div class="line-clamp-1 text-[12px] font-light">{{ ratePlanList$ | async | getPaymentTerm: bundle?.ratePlan?.[0]?.code | stripHtml }}</div>
              </div>
            </div>
          </div>
          <div class="w-[50%] sm:w-full sm:mt-2 border border-solid rounded-[16px] border-primary-color p-3">
            <div class="flex items-center">
              <img loading="lazy" src="assets/beta/gift_opened.svg" />
              <span class="ml-3 font-medium text-[17px]">Services</span>
            </div>
            <div class="mt-3">
              <ng-container *ngFor="let extras of bundle?.ratePlan?.[0]?.includedHotelExtrasList">
                <div class="flex items-start mb-2">
                  <img loading="lazy" src="assets/icons/checked.svg" class="translate-y-[10%]" />
                  <div class="pl-2">
                    <div class="font-normal text-[12px]">{{ extras.name }}</div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-container>
